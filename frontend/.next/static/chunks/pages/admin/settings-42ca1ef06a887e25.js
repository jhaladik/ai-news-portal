(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[577],{8051:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/settings",function(){return s(9392)}])},9392:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var a=s(5893),l=s(7294),r=s(1163),n=s(6904),i=s(5568),d=s(5577);function o(){let e=(0,r.useRouter)(),[t,s]=(0,l.useState)("rss"),[o,c]=(0,l.useState)([]),[m,x]=(0,l.useState)(null),[u,h]=(0,l.useState)(!0),[p,g]=(0,l.useState)(!1),[b,y]=(0,l.useState)(!1),[j,f]=(0,l.useState)({name:"",url:"",category_hint:"local",neighborhood_id:"",priority:1}),v=new i.El;(0,l.useEffect)(()=>{if(!v.getCurrentToken()||!v.isAdmin()){e.push("/login");return}N()},[]);let N=async()=>{try{let e=v.getCurrentToken();if(!e)return;h(!0);let t=await d.Z.getRSSources(e);c(t.sources||[]),x({ai:{openai_model:"gpt-4-turbo",confidence_threshold:.7,max_content_length:2e3,generation_temperature:.7},newsletter:{default_send_time:"08:00",batch_size:100,sender_email:"news@praha.local",reply_to_email:"admin@praha.local",enabled:!0},pipeline:{auto_approve_threshold:.8,max_daily_content:50,retry_attempts:3,parallel_processing:!0},notifications:{admin_email:"admin@praha.local",error_notifications:!0,daily_reports:!0,threshold_alerts:!0}})}catch(e){console.error("Failed to fetch settings:",e)}finally{h(!1)}},_=async(e,t)=>{try{let s=v.getCurrentToken();if(!s)return;await d.Z.updateRSSSource(s,e,{enabled:t}),c(s=>s.map(s=>s.id===e?{...s,enabled:t}:s))}catch(e){console.error("Failed to toggle RSS source:",e)}},w=async()=>{try{let e=v.getCurrentToken();if(!e)return;g(!0);let t=await d.Z.addRSSSource(e,j);c(e=>[...e,t.source]),f({name:"",url:"",category_hint:"local",neighborhood_id:"",priority:1}),y(!1)}catch(e){console.error("Failed to add RSS source:",e)}finally{g(!1)}},S=async e=>{if(confirm("Are you sure you want to delete this RSS source?"))try{let t=v.getCurrentToken();if(!t)return;await d.Z.deleteRSSSource(t,e),c(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Failed to delete RSS source:",e)}},k=async()=>{try{g(!0),console.log("Settings saved:",m),await new Promise(e=>setTimeout(e,1e3))}catch(e){console.error("Failed to save settings:",e)}finally{g(!1)}},C=e=>{let t=Math.floor((Date.now()-e)/1e3);return t<60?"".concat(t,"s ago"):t<3600?"".concat(Math.floor(t/60),"m ago"):t<86400?"".concat(Math.floor(t/3600),"h ago"):"".concat(Math.floor(t/86400),"d ago")},D=e=>{let t=e.error_count/Math.max(e.fetch_count,1),s=e.last_fetched?(Date.now()-e.last_fetched)/36e5:999;return e.enabled?s>24||t>.5?"text-red-500":t>.2?"text-yellow-500":"text-green-500":"text-gray-500"};return u?(0,a.jsx)(n.ZP,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading settings..."})]})})}):(0,a.jsx)(n.ZP,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"⚙️ System Settings"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Configure RSS sources, AI parameters, and system preferences"})]}),(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{key:"rss",label:"RSS Sources",icon:"\uD83D\uDCE1"},{key:"ai",label:"AI Settings",icon:"\uD83E\uDD16"},{key:"newsletter",label:"Newsletter",icon:"\uD83D\uDCE7"},{key:"system",label:"System",icon:"⚙️"}].map(e=>(0,a.jsxs)("button",{onClick:()=>s(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ".concat(t===e.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,a.jsx)("span",{children:e.icon}),(0,a.jsx)("span",{children:e.label})]},e.key))})})}),"rss"===t&&(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"RSS Sources"}),(0,a.jsx)("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",children:"➕ Add Source"})]}),b&&(0,a.jsxs)("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-4",children:"Add New RSS Source"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),(0,a.jsx)("input",{type:"text",value:j.name,onChange:e=>f(t=>({...t,name:e.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"e.g., Prague City News"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RSS URL"}),(0,a.jsx)("input",{type:"url",value:j.url,onChange:e=>f(t=>({...t,url:e.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2",placeholder:"https://example.com/rss"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,a.jsxs)("select",{value:j.category_hint,onChange:e=>f(t=>({...t,category_hint:e.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,a.jsx)("option",{value:"local",children:"Local"}),(0,a.jsx)("option",{value:"business",children:"Business"}),(0,a.jsx)("option",{value:"community",children:"Community"}),(0,a.jsx)("option",{value:"events",children:"Events"}),(0,a.jsx)("option",{value:"emergency",children:"Emergency"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Neighborhood"}),(0,a.jsxs)("select",{value:j.neighborhood_id,onChange:e=>f(t=>({...t,neighborhood_id:e.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,a.jsx)("option",{value:"",children:"All neighborhoods"}),(0,a.jsx)("option",{value:"vinohrady",children:"Vinohrady"}),(0,a.jsx)("option",{value:"karlin",children:"Karl\xedn"}),(0,a.jsx)("option",{value:"smichov",children:"Sm\xedchov"}),(0,a.jsx)("option",{value:"nove_mesto",children:"Nov\xe9 Město"})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex space-x-3",children:[(0,a.jsx)("button",{onClick:w,disabled:!j.name||!j.url||p,className:"px-4 py-2 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 disabled:opacity-50",children:p?"Adding...":"Add Source"}),(0,a.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50",children:"Cancel"})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:0===o.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCE1"}),(0,a.jsx)("p",{className:"text-gray-600",children:"No RSS sources configured"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Add your first RSS source to start collecting content."})]}):o.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"text-lg ".concat(D(e)),children:e.enabled?"\uD83D\uDFE2":"⚪"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600 truncate max-w-md",children:e.url}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-1 text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["Category: ",e.category_hint]}),(0,a.jsxs)("span",{children:["Fetches: ",e.fetch_count]}),(0,a.jsxs)("span",{children:["Errors: ",e.error_count]}),e.last_fetched&&(0,a.jsxs)("span",{children:["Last: ",C(e.last_fetched)]})]})]})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("button",{onClick:()=>_(e.id,!e.enabled),className:"px-3 py-1 rounded text-sm ".concat(e.enabled?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"bg-green-100 text-green-800 hover:bg-green-200"),children:e.enabled?"Disable":"Enable"}),(0,a.jsx)("button",{onClick:()=>S(e.id),className:"px-3 py-1 bg-red-100 text-red-800 rounded text-sm hover:bg-red-200",children:"Delete"})]})]},e.id))})]})}),"ai"===t&&m&&(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"AI Configuration"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"OpenAI Model"}),(0,a.jsxs)("select",{value:m.ai.openai_model,onChange:e=>x(t=>t?{...t,ai:{...t.ai,openai_model:e.target.value}}:null),className:"w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,a.jsx)("option",{value:"gpt-4-turbo",children:"GPT-4 Turbo"}),(0,a.jsx)("option",{value:"gpt-4",children:"GPT-4"}),(0,a.jsx)("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Confidence Threshold (",Math.round(100*m.ai.confidence_threshold),"%)"]}),(0,a.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:m.ai.confidence_threshold,onChange:e=>x(t=>t?{...t,ai:{...t.ai,confidence_threshold:parseFloat(e.target.value)}}:null),className:"w-full"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum confidence score for auto-approval"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Content Length"}),(0,a.jsx)("input",{type:"number",value:m.ai.max_content_length,onChange:e=>x(t=>t?{...t,ai:{...t.ai,max_content_length:parseInt(e.target.value)}}:null),className:"w-full border border-gray-300 rounded-md px-3 py-2"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum characters for generated content"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Generation Temperature (",m.ai.generation_temperature,")"]}),(0,a.jsx)("input",{type:"range",min:"0",max:"2",step:"0.1",value:m.ai.generation_temperature,onChange:e=>x(t=>t?{...t,ai:{...t.ai,generation_temperature:parseFloat(e.target.value)}}:null),className:"w-full"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Higher values = more creative, lower = more focused"})]})]}),(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,a.jsx)("button",{onClick:k,disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50",children:p?"Saving...":"Save AI Settings"})})]}),"newsletter"===t&&m&&(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Newsletter Configuration"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Send Time"}),(0,a.jsx)("input",{type:"time",value:m.newsletter.default_send_time,onChange:e=>x(t=>t?{...t,newsletter:{...t.newsletter,default_send_time:e.target.value}}:null),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Batch Size"}),(0,a.jsx)("input",{type:"number",value:m.newsletter.batch_size,onChange:e=>x(t=>t?{...t,newsletter:{...t.newsletter,batch_size:parseInt(e.target.value)}}:null),className:"w-full border border-gray-300 rounded-md px-3 py-2"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Emails sent per batch"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sender Email"}),(0,a.jsx)("input",{type:"email",value:m.newsletter.sender_email,onChange:e=>x(t=>t?{...t,newsletter:{...t.newsletter,sender_email:e.target.value}}:null),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reply-To Email"}),(0,a.jsx)("input",{type:"email",value:m.newsletter.reply_to_email,onChange:e=>x(t=>t?{...t,newsletter:{...t.newsletter,reply_to_email:e.target.value}}:null),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.newsletter.enabled,onChange:e=>x(t=>t?{...t,newsletter:{...t.newsletter,enabled:e.target.checked}}:null),className:"h-4 w-4 text-blue-600 border-gray-300 rounded mr-2"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Newsletter sending enabled"})]})})]}),(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,a.jsx)("button",{onClick:k,disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50",children:p?"Saving...":"Save Newsletter Settings"})})]}),"system"===t&&m&&(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"System Configuration"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-4",children:"Pipeline Settings"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Auto-Approve Threshold (",Math.round(100*m.pipeline.auto_approve_threshold),"%)"]}),(0,a.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",value:m.pipeline.auto_approve_threshold,onChange:e=>x(t=>t?{...t,pipeline:{...t.pipeline,auto_approve_threshold:parseFloat(e.target.value)}}:null),className:"w-full"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Max Daily Content"}),(0,a.jsx)("input",{type:"number",value:m.pipeline.max_daily_content,onChange:e=>x(t=>t?{...t,pipeline:{...t.pipeline,max_daily_content:parseInt(e.target.value)}}:null),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Retry Attempts"}),(0,a.jsx)("input",{type:"number",value:m.pipeline.retry_attempts,onChange:e=>x(t=>t?{...t,pipeline:{...t.pipeline,retry_attempts:parseInt(e.target.value)}}:null),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.pipeline.parallel_processing,onChange:e=>x(t=>t?{...t,pipeline:{...t.pipeline,parallel_processing:e.target.checked}}:null),className:"h-4 w-4 text-blue-600 border-gray-300 rounded mr-2"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Parallel processing"})]})})]})]}),(0,a.jsxs)("div",{className:"pt-6 border-t border-gray-200",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-4",children:"Notifications"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Email"}),(0,a.jsx)("input",{type:"email",value:m.notifications.admin_email,onChange:e=>x(t=>t?{...t,notifications:{...t.notifications,admin_email:e.target.value}}:null),className:"w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.notifications.error_notifications,onChange:e=>x(t=>t?{...t,notifications:{...t.notifications,error_notifications:e.target.checked}}:null),className:"h-4 w-4 text-blue-600 border-gray-300 rounded mr-2"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Error notifications"})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.notifications.daily_reports,onChange:e=>x(t=>t?{...t,notifications:{...t.notifications,daily_reports:e.target.checked}}:null),className:"h-4 w-4 text-blue-600 border-gray-300 rounded mr-2"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Daily reports"})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.notifications.threshold_alerts,onChange:e=>x(t=>t?{...t,notifications:{...t.notifications,threshold_alerts:e.target.checked}}:null),className:"h-4 w-4 text-blue-600 border-gray-300 rounded mr-2"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Threshold alerts"})]})]})]})]})]}),(0,a.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,a.jsx)("button",{onClick:k,disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50",children:p?"Saving...":"Save System Settings"})})]})]})})})}},1163:function(e,t,s){e.exports=s(3079)}},function(e){e.O(0,[904,888,774,179],function(){return e(e.s=8051)}),_N_E=e.O()}]);