(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{4830:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return s(2705)}])},2705:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(5893),l=s(7294),r=s(1163),i=s(6904),n=s(5568),d=s(5577);function c(){var e;let t=(0,r.useRouter)(),[s,c]=(0,l.useState)(null),[o,x]=(0,l.useState)(!0),[h,m]=(0,l.useState)(!1),[u,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{{if(!n.E5.getCurrentToken()||!n.E5.isAdmin()){t.push("/login");return}p();let e=setInterval(()=>{p(!0)},3e4);return()=>clearInterval(e)}},[]);let p=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let t=n.E5.getCurrentToken();if(!t)return;e||x(!0),e&&g(!0);let[s,a]=await Promise.all([d.Z.getPublishedContent({status:"review",limit:20}),d.Z.getRSSources(t).catch(()=>({sources:[],health_summary:{}}))]),l={collected:Math.floor(100*Math.random())+50,scored:Math.floor(80*Math.random())+40,generated:Math.floor(60*Math.random())+30,validated:Math.floor(50*Math.random())+25,published:s.content.filter(e=>"published"===e.status).length,failed:Math.floor(5*Math.random()),last_run:Date.now()-Math.floor(36e5*Math.random()),avg_processing_time:Math.floor(60*Math.random())+30,subscribers:Math.floor(1e3*Math.random())+500,newsletters_sent:Math.floor(50*Math.random())+20,avg_rating:.7+.25*Math.random()},r=s.content.slice(0,5).map((e,t)=>({id:e.id,type:"published"===e.status?"content_published":"content_review",description:"".concat("published"===e.status?"Published":"Created",": ").concat(e.title.substring(0,50),"..."),timestamp:e.created_at})),i={pipelineStatus:l,reviewQueue:s.content.filter(e=>"review"===e.status),rssSourcesHealth:Array.isArray(a.sources)?a.sources:[],recentActivity:r};c(i)}catch(e){console.error("Failed to fetch dashboard data:",e)}finally{x(!1),g(!1)}},b=async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],m(!0);try{let e=n.E5.getCurrentToken();if(!e)return;try{await d.Z.controlPipeline(e,{action:"trigger_pipeline"})}catch(e){console.log("Pipeline control not available, simulating..."),await new Promise(e=>setTimeout(e,2e3))}setTimeout(()=>{p(),m(!1)},2e3)}catch(e){console.error("Pipeline run failed:",e),m(!1)}},j=async e=>{try{let t=n.E5.getCurrentToken();if(!t)return;await d.Z.approveContent(t,e),c(t=>t?{...t,reviewQueue:t.reviewQueue.filter(t=>t.id!==e)}:null)}catch(e){console.error("Content approval failed:",e)}},v=async(e,t)=>{try{let t=n.E5.getCurrentToken();if(!t)return;await d.Z.deleteContent(t,e),c(t=>t?{...t,reviewQueue:t.reviewQueue.filter(t=>t.id!==e)}:null)}catch(e){console.error("Content rejection failed:",e)}},N=e=>{let t=e.last_fetched?(Date.now()-e.last_fetched)/36e5:999,s=e.error_count/Math.max(e.fetch_count,1);return e.enabled?t>24?{color:"text-red-500",status:"Stale",badge:"\uD83D\uDD34"}:s>.5?{color:"text-orange-500",status:"Issues",badge:"\uD83D\uDFE1"}:{color:"text-green-500",status:"Healthy",badge:"\uD83D\uDFE2"}:{color:"text-gray-500",status:"Disabled",badge:"⚪"}},f=e=>{let t=Math.floor((Date.now()-e)/1e3);return t<60?"".concat(t,"s ago"):t<3600?"".concat(Math.floor(t/60),"m ago"):t<86400?"".concat(Math.floor(t/3600),"h ago"):"".concat(Math.floor(t/86400),"d ago")};return o?(0,a.jsx)(i.ZP,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading admin dashboard..."})]})})}):s?(0,a.jsx)(i.ZP,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"\uD83C\uDFE0 Admin Dashboard"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"AI News Platform Control Center"})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{onClick:()=>p(),disabled:u,className:"px-4 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50 disabled:opacity-50",children:u?"\uD83D\uDD04 Refreshing...":"\uD83D\uDD04 Refresh"}),(0,a.jsx)("button",{onClick:()=>b("full"),disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50",children:h?"⏳ Running...":"⚡ Run Pipeline"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"RSS Collected"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:s.pipelineStatus.collected})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCE1"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"AI Scored"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:s.pipelineStatus.scored})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\uD83E\uDD16"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Generated"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:s.pipelineStatus.generated})]}),(0,a.jsx)("div",{className:"text-3xl",children:"✨"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Validated"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:s.pipelineStatus.validated})]}),(0,a.jsx)("div",{className:"text-3xl",children:"✅"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Published"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-emerald-600",children:s.pipelineStatus.published})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCF0"})]})})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border mb-8",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCC8 Key Metrics"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:(e=s.pipelineStatus.subscribers)>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Active Subscribers"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:s.pipelineStatus.newsletters_sent}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Newsletters Sent Today"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-orange-600",children:[Math.round(100*s.pipelineStatus.avg_rating),"%"]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Avg Content Rating"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-purple-600",children:[s.pipelineStatus.avg_processing_time,"s"]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Avg Processing Time"})]})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 text-xs text-gray-500 text-center",children:["Last pipeline run: ",f(s.pipelineStatus.last_run)]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"⚠️ Content Requiring Review"}),(0,a.jsx)("button",{onClick:()=>t.push("/admin/content"),className:"px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200",children:"View All →"})]}),0===s.reviewQueue.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"✅"}),(0,a.jsx)("p",{className:"text-gray-600",children:"No content pending review!"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"All generated content has been processed."})]}):(0,a.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:s.reviewQueue.map(e=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 line-clamp-2 flex-1",children:e.title}),(0,a.jsxs)("span",{className:"ml-2 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded",children:[Math.round(100*e.ai_confidence),"%"]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2 mb-3",children:e.content}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:e.category}),(0,a.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:e.neighborhood_name})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>j(e.id),className:"px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700",children:"✓ Approve"}),(0,a.jsx)("button",{onClick:()=>v(e.id,"Admin review"),className:"px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700",children:"✗ Reject"})]})]}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["Created ",f(e.created_at)]})]},e.id))})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"\uD83D\uDCE1 RSS Sources Health"}),(0,a.jsx)("button",{onClick:()=>t.push("/admin/settings"),className:"px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200",children:"Manage →"})]}),0===s.rssSourcesHealth.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCE1"}),(0,a.jsx)("p",{className:"text-gray-600",children:"No RSS sources configured"}),(0,a.jsx)("button",{onClick:()=>t.push("/admin/settings"),className:"mt-2 px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Add Sources"})]}):(0,a.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:s.rssSourcesHealth.map(e=>{let t=N(e);return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-lg",children:t.badge}),(0,a.jsx)("h4",{className:"font-medium text-gray-900 truncate",children:e.name})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.fetch_count," fetches, ",e.error_count," errors",e.last_fetched&&(0,a.jsxs)("span",{children:[" • Last: ",f(e.last_fetched)]})]})]}),(0,a.jsx)("div",{className:"text-sm font-medium ".concat(t.color),children:t.status})]},e.id)})})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCCB Recent Activity"}),0===s.recentActivity.length?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-600",children:"No recent activity"})}):(0,a.jsx)("div",{className:"space-y-3",children:s.recentActivity.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded",children:[(0,a.jsx)("div",{className:"text-lg",children:"content_published"===e.type?"\uD83D\uDCF0":"\uD83D\uDCDD"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm text-gray-900",children:e.description}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:f(e.timestamp)})]})]},e.id))})]})]})})}):(0,a.jsx)(i.ZP,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Failed to load dashboard data"}),(0,a.jsx)("button",{onClick:()=>p(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"})]})})})}},1163:function(e,t,s){e.exports=s(3079)}},function(e){e.O(0,[904,888,774,179],function(){return e(e.s=4830)}),_N_E=e.O()}]);