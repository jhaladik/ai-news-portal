(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[112],{8242:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/rss-management",function(){return s(8920)}])},8920:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var a=s(5893),r=s(7294),l=s(9008),c=s.n(l),n=s(1664),d=s.n(n);function o(){let[e,t]=(0,r.useState)([]),[s,l]=(0,r.useState)([]),[n,o]=(0,r.useState)([]),[i,h]=(0,r.useState)(!1),[m,x]=(0,r.useState)(""),[u,g]=(0,r.useState)("sources"),[b,p]=(0,r.useState)({name:"",url:"",category_hint:"local_government"}),[v,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{y()},[]);let y=async()=>{try{h(!0),x(""),t([{id:"praha4",name:"Praha 4 Official",url:"https://www.praha4.cz/rss",enabled:!0,category_hint:"local_government",last_fetched:Date.now()-36e5,fetch_count:145,error_count:3},{id:"praha2",name:"Praha 2 Official",url:"https://www.praha2.cz/rss",enabled:!0,category_hint:"local_government",last_fetched:Date.now()-36e5,fetch_count:138,error_count:1},{id:"dpp",name:"Prague Public Transport",url:"https://www.dpp.cz/rss",enabled:!0,category_hint:"transport",last_fetched:Date.now()-18e5,fetch_count:252,error_count:0},{id:"weather",name:"Prague Weather",url:"https://api.openweathermap.org/data/2.5/weather?q=Prague",enabled:!0,category_hint:"weather",last_fetched:Date.now()-72e5,fetch_count:89,error_count:5}]);try{let t=await fetch(v?"".concat("https://rss-collect.jhaladik.workers.dev","?include_raw=true"):"".concat("https://ai-data-score.jhaladik.workers.dev"));if(t.ok){var e,s;let a=await t.json();v?l((null===(e=a.items)||void 0===e?void 0:e.map(e=>{var t;return{source:e.source,collected:1,errors:[],items:[{id:e.id,title:e.title,content:(null===(t=e.content)||void 0===t?void 0:t.substring(0,200))+"...",score:e.raw_score,category:e.category,collected_at:e.collected_at}]}}))||[]):l((null===(s=a.items)||void 0===s?void 0:s.map(e=>{var t;return{source:e.source,collected:1,errors:[],items:[{id:e.id,title:e.title,content:(null===(t=e.content)||void 0===t?void 0:t.substring(0,200))+"...",score:e.raw_score,category:e.category}]}}))||[])}else l([])}catch(e){l([])}try{let e=await fetch("https://pipeline-orchestrator.jhaladik.workers.dev");e.ok&&(await e.json(),o([{id:"run-"+Date.now(),started_at:Date.now()-36e5,completed_at:Date.now()-33e5,status:"completed",collected_items:45,scored_items:12,generated_items:8,published_items:6},{id:"run-"+(Date.now()-864e5),started_at:Date.now()-9e7,completed_at:Date.now()-897e5,status:"completed",collected_items:38,scored_items:15,generated_items:11,published_items:9}]))}catch(e){o([])}}catch(e){x("❌ Chyba při nač\xedt\xe1n\xed dat: "+e.message)}finally{h(!1)}},N=async e=>{h(!0);try{let t=await fetch("https://rss-collect.jhaladik.workers.dev",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sources:[e]})});if(t.ok){let s=await t.json();x("✅ RSS collection z ".concat(e,": ").concat(s.collected," položek")),await y()}else x("❌ Chyba při RSS collection")}catch(e){x("❌ S\xedťov\xe1 chyba")}h(!1)},f=async()=>{h(!0);try{let e=await fetch("https://rss-collect.jhaladik.workers.dev",{method:"POST"});if(e.ok){let t=await e.json();l(t.sources||[]),x("✅ Kompletn\xed RSS collection: ".concat(t.collected," položek ze ").concat(t.sources.success," zdrojů")),await y()}else x("❌ Chyba při RSS collection")}catch(e){x("❌ S\xedťov\xe1 chyba")}h(!1)},_=async(e,s)=>{t(t=>t.map(t=>t.id===e?{...t,enabled:s}:t)),x("✅ Zdroj ".concat(e," ").concat(s?"aktivov\xe1n":"deaktivov\xe1n"))},w=async()=>{if(!b.name||!b.url){x("❌ Vyplňte n\xe1zev a URL");return}let e={id:b.name.toLowerCase().replace(/\s+/g,"-"),name:b.name,url:b.url,enabled:!0,category_hint:b.category_hint,last_fetched:0,fetch_count:0,error_count:0};t(t=>[...t,e]),p({name:"",url:"",category_hint:"local_government"}),x("✅ Nov\xfd RSS zdroj ".concat(e.name," přid\xe1n"))},D=e=>{let t=e.error_count/Math.max(e.fetch_count,1),s=(Date.now()-e.last_fetched)/36e5;return e.enabled?t>.1||s>6?"text-red-500":t>.05||s>3?"text-yellow-500":"text-green-500":"text-gray-500"},C=e=>{let t=e.error_count/Math.max(e.fetch_count,1),s=(Date.now()-e.last_fetched)/36e5;return e.enabled?t>.1?"Vysok\xe1 chybovost":s>6?"Neaktivn\xed":s>3?"Zastaral\xe9":"Zdrav\xfd":"Zak\xe1z\xe1no"},k=e=>e?new Date(e).toLocaleString("cs-CZ"):"Nikdy",S=e=>({local_government:"bg-blue-100 text-blue-800",transport:"bg-orange-100 text-orange-800",weather:"bg-yellow-100 text-yellow-800",business:"bg-green-100 text-green-800",emergency:"bg-red-100 text-red-800",community:"bg-purple-100 text-purple-800"})[e]||"bg-gray-100 text-gray-800";return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c(),{children:(0,a.jsx)("title",{children:"RSS Management - Phase 2b Pipeline"})}),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"\uD83D\uDCE1 RSS Management"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Spr\xe1va RSS zdrojů a pipeline monitoring"})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{onClick:f,disabled:i,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:"\uD83D\uDD04 Collect All Sources"}),(0,a.jsx)(d(),{href:"/admin/ai-dashboard",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"\uD83E\uDD16 AI Dashboard"}),(0,a.jsx)(d(),{href:"/admin/dashboard",className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"\uD83D\uDCCB Admin Dashboard"})]})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"text-center p-3 bg-blue-50 rounded-lg border border-blue-200",children:[(0,a.jsx)("div",{className:"text-xl font-bold text-blue-600",children:e.filter(e=>e.enabled).length}),(0,a.jsx)("div",{className:"text-sm text-blue-700",children:"Aktivn\xed zdroje"})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-green-50 rounded-lg border border-green-200",children:[(0,a.jsx)("div",{className:"text-xl font-bold text-green-600",children:e.filter(e=>"Zdrav\xfd"===C(e)).length}),(0,a.jsx)("div",{className:"text-sm text-green-700",children:"Zdrav\xe9 zdroje"})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[(0,a.jsx)("div",{className:"text-xl font-bold text-yellow-600",children:e.reduce((e,t)=>e+t.fetch_count,0)}),(0,a.jsx)("div",{className:"text-sm text-yellow-700",children:"Celkem fetchů"})]}),(0,a.jsxs)("div",{className:"text-center p-3 bg-red-50 rounded-lg border border-red-200",children:[(0,a.jsx)("div",{className:"text-xl font-bold text-red-600",children:e.reduce((e,t)=>e+t.error_count,0)}),(0,a.jsx)("div",{className:"text-sm text-red-700",children:"Celkem chyb"})]})]})]})}),(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[m&&(0,a.jsx)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:m}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,a.jsxs)("div",{className:"flex border-b",children:[(0,a.jsx)("button",{onClick:()=>g("sources"),className:"px-6 py-3 font-medium ".concat("sources"===u?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"\uD83D\uDCE1 RSS Sources"}),(0,a.jsx)("button",{onClick:()=>g("collection"),className:"px-6 py-3 font-medium ".concat("collection"===u?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"\uD83D\uDCCA Collection Results"}),(0,a.jsx)("button",{onClick:()=>g("history"),className:"px-6 py-3 font-medium ".concat("history"===u?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"),children:"\uD83D\uDCC8 Pipeline History"})]}),(0,a.jsxs)("div",{className:"p-6",children:["sources"===u&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsx)("h3",{className:"font-semibold mb-3",children:"➕ Přidat nov\xfd RSS zdroj"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[(0,a.jsx)("input",{type:"text",placeholder:"N\xe1zev zdroje",value:b.name,onChange:e=>p({...b,name:e.target.value}),className:"px-3 py-2 border rounded"}),(0,a.jsx)("input",{type:"url",placeholder:"RSS URL",value:b.url,onChange:e=>p({...b,url:e.target.value}),className:"px-3 py-2 border rounded"}),(0,a.jsxs)("select",{value:b.category_hint,onChange:e=>p({...b,category_hint:e.target.value}),className:"px-3 py-2 border rounded",children:[(0,a.jsx)("option",{value:"local_government",children:"Local Government"}),(0,a.jsx)("option",{value:"transport",children:"Transport"}),(0,a.jsx)("option",{value:"weather",children:"Weather"}),(0,a.jsx)("option",{value:"business",children:"Business"}),(0,a.jsx)("option",{value:"emergency",children:"Emergency"}),(0,a.jsx)("option",{value:"community",children:"Community"})]}),(0,a.jsx)("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Přidat"})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,a.jsx)("div",{className:"border rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("h3",{className:"font-medium text-lg",children:e.name}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat(S(e.category_hint)),children:e.category_hint}),(0,a.jsxs)("span",{className:"text-sm font-medium ".concat(D(e)),children:["● ",C(e)]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-3 break-all",children:e.url}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Posledn\xed fetch:"}),(0,a.jsx)("div",{className:"font-medium",children:k(e.last_fetched)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Celkem fetchů:"}),(0,a.jsx)("div",{className:"font-medium",children:e.fetch_count})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Chyby:"}),(0,a.jsx)("div",{className:"font-medium text-red-600",children:e.error_count})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Chybovost:"}),(0,a.jsxs)("div",{className:"font-medium",children:[e.fetch_count>0?Math.round(e.error_count/e.fetch_count*100):0,"%"]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 ml-4",children:[(0,a.jsx)("button",{onClick:()=>N(e.id),disabled:i||!e.enabled,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50",children:"\uD83D\uDCE1 Collect"}),(0,a.jsx)("button",{onClick:()=>_(e.id,!e.enabled),className:"px-3 py-1 text-sm rounded ".concat(e.enabled?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"),children:e.enabled?"⏸️ Zak\xe1zat":"▶️ Povolit"})]})]})},e.id))})]}),"collection"===u&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"\uD83D\uDCCA V\xfdsledky posledn\xedho collection"}),(0,a.jsx)("button",{onClick:()=>j(!v),className:"px-4 py-2 rounded-lg font-medium ".concat(v?"bg-orange-100 text-orange-700 hover:bg-orange-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:v?"\uD83C\uDFAF Show Qualified Only":"\uD83D\uDCCA Show All Raw Items"}),(0,a.jsx)("button",{onClick:f,disabled:i,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:"\uD83D\uDD04 Nov\xe9 collection"})]}),s.length>0?(0,a.jsx)("div",{className:"space-y-4",children:s.map((e,t)=>(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,a.jsx)("h4",{className:"font-medium",children:e.source}),(0,a.jsxs)("span",{className:"px-2 py-1 text-sm rounded bg-blue-100 text-blue-800",children:[e.collected," položek"]})]}),e.errors.length>0&&(0,a.jsxs)("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded",children:[(0,a.jsx)("h5",{className:"font-medium text-red-800 mb-2",children:"Chyby:"}),(0,a.jsx)("ul",{className:"text-sm text-red-700 space-y-1",children:e.errors.map((e,t)=>(0,a.jsxs)("li",{children:["• ",e]},t))})]}),e.items.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"font-medium mb-2",children:"Sebran\xe9 položky:"}),(0,a.jsxs)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:[e.items.slice(0,5).map((e,t)=>(0,a.jsxs)("div",{className:"text-sm p-2 bg-gray-50 rounded",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:e.title}),(0,a.jsx)("div",{className:"text-gray-600 line-clamp-2",children:e.content}),e.score&&(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-700 px-1 rounded",children:["Score: ",Math.round(100*e.score),"%"]}),e.category&&(0,a.jsx)("span",{className:"ml-2 text-xs bg-green-100 text-green-700 px-1 rounded",children:e.category})]})]},t)),e.items.length>5&&(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["... a dalš\xedch ",e.items.length-5," položek"]})]})]})]},t))}):(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"\uD83D\uDCDD Ž\xe1dn\xe9 v\xfdsledky. Spusťte collection pro zobrazen\xed dat."})]}),"history"===u&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"\uD83D\uDCC8 Historie pipeline runů"}),(0,a.jsx)("div",{className:"space-y-4",children:n.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium",children:["Pipeline Run ",e.id]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[k(e.started_at)," - ",k(e.completed_at)]})]}),(0,a.jsx)("span",{className:"px-2 py-1 text-sm rounded ".concat("completed"===e.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.status})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"text-center p-2 bg-blue-50 rounded",children:[(0,a.jsx)("div",{className:"font-bold text-blue-600",children:e.collected_items}),(0,a.jsx)("div",{className:"text-blue-700",children:"Collected"})]}),(0,a.jsxs)("div",{className:"text-center p-2 bg-purple-50 rounded",children:[(0,a.jsx)("div",{className:"font-bold text-purple-600",children:e.scored_items}),(0,a.jsx)("div",{className:"text-purple-700",children:"Scored"})]}),(0,a.jsxs)("div",{className:"text-center p-2 bg-green-50 rounded",children:[(0,a.jsx)("div",{className:"font-bold text-green-600",children:e.generated_items}),(0,a.jsx)("div",{className:"text-green-700",children:"Generated"})]}),(0,a.jsxs)("div",{className:"text-center p-2 bg-orange-50 rounded",children:[(0,a.jsx)("div",{className:"font-bold text-orange-600",children:e.published_items}),(0,a.jsx)("div",{className:"text-orange-700",children:"Published"})]})]}),(0,a.jsxs)("div",{className:"mt-3 text-sm text-gray-600",children:["Duration: ",Math.round((e.completed_at-e.started_at)/1e3),"s • Success rate: ",Math.round(e.published_items/Math.max(e.collected_items,1)*100),"%"]})]},e.id))})]})]})]})]})]})]})}}},function(e){e.O(0,[996,888,774,179],function(){return e(e.s=8242)}),_N_E=e.O()}]);