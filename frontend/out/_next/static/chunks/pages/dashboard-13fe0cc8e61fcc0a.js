(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{528:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(153)}])},153:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return f}});var a=t(5893),l=t(7294),r=t(1163),i=t(6904),n=t(4911);let c=["emergency","local","business","community","events"],o=["draft","ai_generated","review","published","rejected","failed"];var d=t(8997),x=t(4410),h=t(6650),m=e=>{var s;let{filters:t,neighborhoods:r=[],onFiltersChange:i,showStatus:n=!1,showAdvanced:m=!1,variant:u="sidebar",className:g=""}=e,[b,f]=(0,l.useState)(t),[j,p]=(0,l.useState)(!1),[v,y]=(0,l.useState)(!1);(0,l.useEffect)(()=>{f(t)},[t]),(0,l.useEffect)(()=>{y(!!(b.neighborhood||b.category||b.status))},[b]);let N=(e,s)=>{let t={...b,[e]:s||void 0};f(t),i(t)},D=()=>{let e={};f(e),i(e)},w=()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Neighborhood"}),(0,a.jsxs)("select",{value:b.neighborhood||"",onChange:e=>N("neighborhood",e.target.value),className:"block w-full border border-gray-300 rounded-md px-3 py-2 bg-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"",children:"All Neighborhoods"}),r.map(e=>(0,a.jsx)("option",{value:e.slug,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Category"}),(0,a.jsx)("div",{className:"space-y-2",children:"horizontal"===u?(0,a.jsxs)("select",{value:b.category||"",onChange:e=>N("category",e.target.value),className:"block w-full border border-gray-300 rounded-md px-3 py-2 bg-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"",children:"All Categories"}),c.map(e=>(0,a.jsx)("option",{value:e,children:(0,d.DG)(e)},e))]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"category",value:"",checked:!b.category,onChange:e=>N("category",e.target.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"All Categories"})]}),c.map(e=>(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"category",value:e,checked:b.category===e,onChange:e=>N("category",e.target.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:(0,d.DG)(e)})]},e))]})})]}),n&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,a.jsxs)("select",{value:b.status||"",onChange:e=>N("status",e.target.value),className:"block w-full border border-gray-300 rounded-md px-3 py-2 bg-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"",children:"All Statuses"}),o.map(e=>(0,a.jsx)("option",{value:e,children:(0,d.Ls)(e.replace("_"," "))},e))]})]}),v&&(0,a.jsx)("div",{className:"pt-4 border-t border-gray-200",children:(0,a.jsxs)(x.Z,{variant:"ghost",size:"sm",onClick:D,className:"w-full",children:[(0,a.jsx)("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Clear All Filters"]})})]});if("horizontal"===u)return(0,a.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 ".concat(g),children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:w()})});if("compact"===u){let e;return(0,a.jsxs)("div",{className:g,children:[(0,a.jsx)("div",{className:"md:hidden mb-4",children:(0,a.jsxs)(x.Z,{variant:"secondary",size:"sm",onClick:()=>p(!j),className:"w-full",children:[(0,a.jsx)("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.707A1 1 0 013 7V4z"})}),"Filters",v&&(0,a.jsx)("span",{className:"ml-2 bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-xs",children:(e=0,b.neighborhood&&e++,b.category&&e++,b.status&&e++,e)})]})}),(0,a.jsx)("div",{className:"md:block ".concat(j?"block":"hidden"),children:(0,a.jsx)(h.Z,{padding:"sm",children:(0,a.jsx)("div",{className:"space-y-4",children:w()})})})]})}return(0,a.jsxs)("div",{className:g,children:[(0,a.jsx)(h.Z,{title:"Filters",padding:"md",children:(0,a.jsx)("div",{className:"space-y-6",children:w()})}),v&&(0,a.jsx)(h.Z,{className:"mt-4",padding:"sm",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Active Filters"}),(0,a.jsxs)("div",{className:"space-y-1",children:[b.neighborhood&&(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Neighborhood:"}),(0,a.jsx)("span",{className:"font-medium",children:(null===(s=r.find(e=>e.slug===b.neighborhood))||void 0===s?void 0:s.name)||b.neighborhood})]}),b.category&&(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Category:"}),(0,a.jsx)("span",{className:"font-medium",children:(0,d.DG)(b.category)})]}),b.status&&(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,a.jsx)("span",{className:"font-medium",children:(0,d.Ls)(b.status.replace("_"," "))})]})]})]})}),m&&(0,a.jsx)(h.Z,{className:"mt-4",padding:"sm",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Statistics"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-blue-600",children:r.length}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Neighborhoods"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-green-600",children:c.length}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:"Categories"})]})]})]})})]})},u=t(5568),g=t(5577);let b=()=>{try{return u.E5.getCurrentToken()}catch(e){return console.log("authManager not available, using localStorage fallback"),localStorage.getItem("authToken")}};function f(){let e=(0,r.useRouter)(),[s,t]=(0,l.useState)(null),[c,o]=(0,l.useState)(null),[d,x]=(0,l.useState)(null),[h,u]=(0,l.useState)(!0),[f,j]=(0,l.useState)(!1),[p,v]=(0,l.useState)({category:"all",neighborhood:"all",limit:20,offset:0});(0,l.useEffect)(()=>{{console.log("\uD83D\uDD0D Dashboard useEffect starting");let s=b();if(console.log("\uD83D\uDD0D Token retrieved:",s?"Present":"Missing"),!s){console.log("\uD83D\uDD0D No token, redirecting to login"),e.push("/login");return}console.log("\uD83D\uDD0D Token found, loading dashboard data"),y()}},[]),(0,l.useEffect)(()=>{s&&N()},[p,s]);let y=async()=>{console.log("\uD83D\uDD0D Dashboard: fetchInitialData started");try{let e=b();if(console.log("\uD83D\uDD0D Dashboard: token retrieved:",e?"Present":"Missing"),!e){console.log("\uD83D\uDD0D Dashboard: No token, redirecting to login");return}u(!0),console.log("\uD83D\uDD0D Dashboard: Calling APIs...");let[s,a]=await Promise.all([g.Z.getUserProfile(e),g.Z.getUserDashboard(e,{limit:p.limit,offset:p.offset})]);console.log("\uD83D\uDD0D Dashboard: API responses received",{profile:s,dashboard:a}),t(s.profile),o(s.statistics),x(a)}catch(s){console.error("\uD83D\uDD0D Dashboard: fetchInitialData error:",s),e.push("/login")}finally{u(!1)}},N=async()=>{try{let e=b();if(!e)return;j(!0);let s={limit:p.limit,offset:p.offset,category:"all"!==p.category?p.category:void 0,neighborhood:"all"!==p.neighborhood?p.neighborhood:void 0},t=await g.Z.getUserDashboard(e,s);x(t)}catch(e){console.error("Failed to fetch personalized feed:",e)}finally{j(!1)}},D=e=>{v(e)},w=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),k=e=>{let s=Math.floor((Date.now()-e)/1e3);return s<60?"".concat(s,"s ago"):s<3600?"".concat(Math.floor(s/60),"m ago"):s<86400?"".concat(Math.floor(s/3600),"h ago"):"".concat(Math.floor(s/86400),"d ago")},C=[{id:"vinohrady",name:"Vinohrady",slug:"vinohrady",subscriber_count:245,status:"active",created_at:Date.now()},{id:"karlin",name:"Karl\xedn",slug:"karlin",subscriber_count:189,status:"active",created_at:Date.now()},{id:"smichov",name:"Sm\xedchov",slug:"smichov",subscriber_count:156,status:"active",created_at:Date.now()},{id:"nove_mesto",name:"Nov\xe9 Město",slug:"nove_mesto",subscriber_count:312,status:"active",created_at:Date.now()}];return h?(0,a.jsx)(i.ZP,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading your personalized dashboard..."})]})})}):s&&d?(0,a.jsx)(i.ZP,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:["Welcome back, ",s.name||s.email.split("@")[0],"! \uD83D\uDC4B"]}),(0,a.jsxs)("p",{className:"mt-2 text-gray-600",children:["Your personalized Prague news dashboard for ",s.neighborhood_name]})]}),c&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Content Views"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:w(c.content_views||0)})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCD6"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Newsletters Clicked"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:w(c.newsletters_clicked||0)})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCE7"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Open Rate"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-purple-600",children:[Math.round(100*(c.open_rate||0)),"%"]})]}),(0,a.jsx)("div",{className:"text-3xl",children:"\uD83D\uDCCA"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Click Rate"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-orange-600",children:[Math.round(100*(c.click_rate||0)),"%"]})]}),(0,a.jsx)("div",{className:"text-3xl",children:"⭐"})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-1",children:[(0,a.jsx)(m,{filters:{neighborhood:p.neighborhood,category:p.category},neighborhoods:C,onFiltersChange:e=>D({...p,neighborhood:e.neighborhood||"all",category:e.category||"all"}),showStatus:!1,showAdvanced:!0,variant:"sidebar"}),(0,a.jsxs)("div",{className:"mt-6 bg-white p-4 rounded-lg shadow-sm border",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{onClick:()=>e.push("/profile"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded",children:"\uD83D\uDCDD Edit Profile"}),(0,a.jsx)("button",{onClick:()=>e.push("/preferences"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded",children:"⚙️ Preferences"}),(0,a.jsx)("button",{onClick:()=>e.push("/newsletters"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded",children:"\uD83D\uDCE7 Newsletter Archive"})]})]}),d.recent_activity&&d.recent_activity.length>0&&(0,a.jsxs)("div",{className:"mt-6 bg-white p-4 rounded-lg shadow-sm border",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Recent Activity"}),(0,a.jsx)("div",{className:"space-y-3",children:d.recent_activity.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("p",{className:"text-gray-900",children:e.description}),(0,a.jsx)("p",{className:"text-gray-500 text-xs",children:k(e.timestamp)})]},e.id))})]})]}),(0,a.jsxs)("div",{className:"lg:col-span-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Your Personalized News Feed"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{onClick:N,disabled:f,className:"px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50",children:["\uD83D\uDD04"," Refresh"]}),(0,a.jsxs)("select",{value:p.limit,onChange:e=>D({...p,limit:parseInt(e.target.value),offset:0}),className:"border border-gray-300 rounded px-2 py-1 text-sm",children:[(0,a.jsx)("option",{value:10,children:"10 articles"}),(0,a.jsx)("option",{value:20,children:"20 articles"}),(0,a.jsx)("option",{value:50,children:"50 articles"})]})]})]}),f&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading personalized content..."})]}),!f&&(0,a.jsxs)(a.Fragment,{children:[0===d.content.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCF0"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No content found"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Try adjusting your filters or check back later for new content."}),(0,a.jsx)("button",{onClick:()=>D({...p,category:"all",neighborhood:"all"}),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Clear Filters"})]}):(0,a.jsx)("div",{className:"space-y-6",children:d.content.map(e=>(0,a.jsx)(n.Z,{content:e,variant:"default",showActions:!1,className:"hover:shadow-md transition-shadow"},e.id))}),d.content.length>=p.limit&&(0,a.jsxs)("div",{className:"mt-8 flex justify-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>D({...p,offset:Math.max(0,p.offset-p.limit)}),disabled:0===p.offset,className:"px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,a.jsxs)("span",{className:"px-4 py-2 text-sm text-gray-600",children:["Showing ",p.offset+1," - ",Math.min(p.offset+p.limit,p.offset+d.content.length)]}),(0,a.jsx)("button",{onClick:()=>D({...p,offset:p.offset+p.limit}),disabled:d.content.length<p.limit,className:"px-4 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]}),c&&c.favorite_categories.length>0&&(0,a.jsxs)("div",{className:"mt-12 bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Your Favorite Categories"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:c.favorite_categories.map(e=>(0,a.jsx)("button",{onClick:()=>D({...p,category:e,offset:0}),className:"px-3 py-1 rounded-full text-sm ".concat(p.category===e?"bg-blue-600 text-white":"bg-blue-100 text-blue-800 hover:bg-blue-200"),children:e.replace("_"," ")},e))})]}),d.user_preferences&&(0,a.jsxs)("div",{className:"mt-8 bg-white p-6 rounded-lg shadow-sm border",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Newsletter Preferences"}),(0,a.jsx)("button",{onClick:()=>e.push("/preferences"),className:"px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm hover:bg-blue-200",children:"Edit Preferences →"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Frequency:"}),(0,a.jsx)("span",{className:"ml-2 capitalize",children:d.user_preferences.notification_frequency})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Email:"}),(0,a.jsx)("span",{className:"ml-2 ".concat(d.user_preferences.email_enabled?"text-green-600":"text-red-600"),children:d.user_preferences.email_enabled?"Enabled":"Disabled"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Categories:"}),(0,a.jsxs)("span",{className:"ml-2",children:[d.user_preferences.categories.length," selected"]})]})]})]})]})})}):(0,a.jsx)(i.ZP,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Failed to load dashboard data"}),(0,a.jsx)("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"})]})})})}},1163:function(e,s,t){e.exports=t(3079)}},function(e){e.O(0,[904,594,888,774,179],function(){return e(e.s=528)}),_N_E=e.O()}]);