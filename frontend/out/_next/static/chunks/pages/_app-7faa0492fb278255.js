(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{3454:function(e,t,r){"use strict";var n,s;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(7663)},6840:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return r(9645)}])},6887:function(e,t,r){"use strict";r.d(t,{Ho:function(){return h},aC:function(){return l}});var n=r(5893),s=r(7294),o=r(5568),i=r(5577),a=r(8997),c=r(971);let u=(0,s.createContext)(void 0),l=()=>{let e=(0,s.useContext)(u);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},h=e=>{let{children:t}=e,[r,l]=(0,s.useState)(null),[h,d]=(0,s.useState)(null),[m,f]=(0,s.useState)(!1),[g,p]=(0,s.useState)(!1),[y,b]=(0,s.useState)(!0),{showSuccess:k,showError:w}=(0,c.x_)(),v=(0,s.useCallback)(()=>{try{let e=o.E5.getAuthState();l(e.user),d(e.token),f(e.isAuthenticated),p(e.isAdmin)}catch(e){console.error("Error initializing auth state:",e)}finally{b(!1)}},[]),S=(0,s.useCallback)(async e=>{try{let t=await i.Z.login(e);if(t.success&&t.token&&t.user)return o.E5.login(t.token,t.user),l(t.user),d(t.token),f(!0),p("admin"===t.user.role),k("Welcome back!","Signed in as ".concat(t.user.email)),t;throw Error(t.message||"Login failed")}catch(e){throw w("Login failed",(0,a.e$)(e)),e}},[k,w]),R=(0,s.useCallback)(()=>{o.E5.logout(),l(null),d(null),f(!1),p(!1),k("Signed out successfully")},[k]);return(0,s.useCallback)(e=>{o.E5.updateUser(e),l(e),p("admin"===e.role)},[]),(0,s.useEffect)(()=>((0,o.uJ)(),v(),o.E5.subscribe(()=>{let e=o.E5.getAuthState();l(e.user),d(e.token),f(e.isAuthenticated),p(e.isAdmin)})),[v]),(0,s.useEffect)(()=>{if(!m||!h)return;let e=setInterval(()=>{o.E5.checkTokenExpiration()},3e5);return()=>clearInterval(e)},[m,h]),(0,s.useEffect)(()=>{let e=()=>{m&&o.E5.checkTokenExpiration()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[m]),(0,n.jsx)(u.Provider,{value:{user:r,token:h,login:S,logout:R,isAuthenticated:m,isAdmin:g,loading:y},children:t})}},971:function(e,t,r){"use strict";r.d(t,{VW:function(){return u},x_:function(){return l}});var n=r(5893),s=r(7294);let o=(0,s.createContext)(void 0),i=()=>{let e=(0,s.useContext)(o);if(!e)throw Error("useToast must be used within a ToastProvider");return e},a=e=>{let{toast:t,onRemove:r}=e,[o,i]=(0,s.useState)(!1),[a,c]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=setTimeout(()=>i(!0),100);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{u()},t.duration||5e3);return()=>clearTimeout(e)},[t.duration]);let u=(0,s.useCallback)(()=>{c(!0),setTimeout(()=>{r(t.id)},300)},[t.id,r]),l={success:{bg:"bg-green-50",border:"border-green-200",icon:"text-green-400",title:"text-green-800",message:"text-green-700"},error:{bg:"bg-red-50",border:"border-red-200",icon:"text-red-400",title:"text-red-800",message:"text-red-700"},warning:{bg:"bg-yellow-50",border:"border-yellow-200",icon:"text-yellow-400",title:"text-yellow-800",message:"text-yellow-700"},info:{bg:"bg-blue-50",border:"border-blue-200",icon:"text-blue-400",title:"text-blue-800",message:"text-blue-700"}}[t.type],h={success:(0,n.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),error:(0,n.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),warning:(0,n.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),info:(0,n.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})};return(0,n.jsx)("div",{className:"\n        max-w-sm w-full ".concat(l.bg," ").concat(l.border," border rounded-lg shadow-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden\n        transform transition-all duration-300 ease-in-out\n        ").concat(o&&!a?"translate-x-0 opacity-100":"translate-x-full opacity-0","\n      "),children:(0,n.jsx)("div",{className:"p-4",children:(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("div",{className:"flex-shrink-0 ".concat(l.icon),children:h[t.type]}),(0,n.jsxs)("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:[(0,n.jsx)("p",{className:"text-sm font-medium ".concat(l.title),children:t.title}),t.message&&(0,n.jsx)("p",{className:"mt-1 text-sm ".concat(l.message),children:t.message})]}),(0,n.jsx)("div",{className:"ml-4 flex-shrink-0 flex",children:(0,n.jsxs)("button",{className:"inline-flex ".concat(l.icon," hover:opacity-75 transition-opacity"),onClick:u,children:[(0,n.jsx)("span",{className:"sr-only",children:"Close"}),(0,n.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})})]})})})},c=e=>{let{toasts:t,onRemove:r}=e;return(0,n.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:t.map(e=>(0,n.jsx)(a,{toast:e,onRemove:r},e.id))})},u=e=>{let{children:t}=e,[r,i]=(0,s.useState)([]),a=(0,s.useCallback)(e=>{let t=Math.random().toString(36).substr(2,9),r={...e,id:t};i(e=>[...e,r])},[]),u=(0,s.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e))},[]);return(0,n.jsxs)(o.Provider,{value:{addToast:a,removeToast:u},children:[t,(0,n.jsx)(c,{toasts:r,onRemove:u})]})},l=()=>{let{addToast:e}=i();return{showSuccess:(t,r)=>e({type:"success",title:t,message:r}),showError:(t,r)=>e({type:"error",title:t,message:r}),showWarning:(t,r)=>e({type:"warning",title:t,message:r}),showInfo:(t,r)=>e({type:"info",title:t,message:r})}}},5577:function(e,t,r){"use strict";var n=r(3454);class s{async makeRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n={"Content-Type":"application/json"};r&&(n.Authorization="Bearer ".concat(r));try{let r=await fetch(e,{...t,headers:n});if(!r.ok){let e=await r.json().catch(()=>({error:"Request failed",status:r.status}));throw{error:e.error||"Request failed",status:r.status,details:e.details}}return await r.json()}catch(e){if(e&&"object"==typeof e&&"status"in e)throw e;throw{error:"Network error",status:0,details:e instanceof Error?e.message:"Unknown error"}}}async login(e){return this.makeRequest(this.baseURLs.auth,{method:"POST",body:JSON.stringify(e)})}async getPublishedContent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.neighborhood&&t.append("neighborhood",e.neighborhood),e.category&&t.append("category",e.category),e.limit&&t.append("limit",e.limit.toString()),e.offset&&t.append("offset",e.offset.toString());let r="".concat(this.baseURLs.contentList).concat(t.toString()?"?".concat(t.toString()):"");return this.makeRequest(r)}async subscribeToNewsletter(e){return this.makeRequest(this.baseURLs.newsletterSignup,{method:"POST",body:JSON.stringify(e)})}async getUserDashboard(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URLSearchParams;t.limit&&r.append("limit",t.limit.toString()),t.offset&&r.append("offset",t.offset.toString()),t.category&&r.append("category",t.category);let n="".concat(this.baseURLs.userDashboard).concat(r.toString()?"?".concat(r.toString()):"");return this.makeRequest(n,{method:"GET"},e)}async getUserPreferences(e){return this.makeRequest(this.baseURLs.userPreferences,{method:"GET"},e)}async updateUserPreferences(e,t){return this.makeRequest(this.baseURLs.userPreferences,{method:"PUT",body:JSON.stringify(t)},e)}async getUserProfile(e){return this.makeRequest(this.baseURLs.userProfile,{method:"GET"},e)}async updateUserProfile(e,t){return this.makeRequest(this.baseURLs.userProfile,{method:"PUT",body:JSON.stringify(t)},e)}async deleteUserAccount(e){return this.makeRequest("".concat(this.baseURLs.userProfile,"?confirm=true"),{method:"DELETE"},e)}async getNewsletterArchive(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URLSearchParams;t.limit&&r.append("limit",t.limit.toString()),t.offset&&r.append("offset",t.offset.toString());let n="".concat(this.baseURLs.newsletterArchive).concat(r.toString()?"?".concat(r.toString()):"");return this.makeRequest(n,{method:"GET"},e)}async trackNewsletterOpen(e,t){return this.makeRequest("".concat(this.baseURLs.newsletterArchive,"/open/").concat(t),{method:"POST"},e)}async trackNewsletterClick(e,t){return this.makeRequest("".concat(this.baseURLs.newsletterArchive,"/click/").concat(t),{method:"POST"},e)}async getAdminDashboard(e){return this.makeRequest(this.baseURLs.adminDashboard,{method:"GET"},e)}async getAdminAnalytics(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"7d",r=arguments.length>2?arguments[2]:void 0,n=new URLSearchParams({timeframe:t});r&&n.append("neighborhood",r);let s="".concat(this.baseURLs.adminAnalytics,"?").concat(n.toString());return this.makeRequest(s,{method:"GET"},e)}async controlPipeline(e,t){return this.makeRequest(this.baseURLs.adminPipeline,{method:"POST",body:JSON.stringify(t)},e)}async getPipelineStatus(e){return this.makeRequest(this.baseURLs.adminPipeline,{method:"GET"},e)}async getContentForEdit(e,t){return this.makeRequest("".concat(this.baseURLs.contentOverride,"/").concat(t),{method:"GET"},e)}async overrideContent(e,t,r){return this.makeRequest("".concat(this.baseURLs.contentOverride,"/").concat(t),{method:"PUT",body:JSON.stringify(r)},e)}async deleteContent(e,t){return this.makeRequest("".concat(this.baseURLs.contentOverride,"/").concat(t,"?confirm=true"),{method:"DELETE"},e)}async createContent(e,t){return this.makeRequest(this.baseURLs.contentCreate,{method:"POST",body:JSON.stringify(t)},e)}async approveContent(e,t){return this.makeRequest(this.baseURLs.contentApprove,{method:"POST",body:JSON.stringify({content_id:t})},e)}async getRSSources(e){return this.makeRequest(this.baseURLs.rssSources,{method:"GET"},e)}async addRSSSource(e,t){return this.makeRequest(this.baseURLs.rssSources,{method:"POST",body:JSON.stringify(t)},e)}async updateRSSSource(e,t,r){return this.makeRequest("".concat(this.baseURLs.rssSources,"/").concat(t),{method:"PUT",body:JSON.stringify(r)},e)}async deleteRSSSource(e,t){return this.makeRequest("".concat(this.baseURLs.rssSources,"/").concat(t,"?confirm=true"),{method:"DELETE"},e)}async getNewsletterTemplates(){return this.makeRequest(this.baseURLs.newsletterTemplate,{method:"GET"})}async generateNewsletter(e,t){let r=new URLSearchParams({action:"generate",neighborhood_id:t});return this.makeRequest("".concat(this.baseURLs.newsletterTemplate,"?").concat(r.toString()),{method:"GET"},e)}async createNewsletterFromTemplate(e,t){return this.makeRequest(this.baseURLs.newsletterTemplate,{method:"POST",body:JSON.stringify(t)},e)}async sendNewsletter(e,t){return this.makeRequest(this.baseURLs.newsletterSend,{method:"POST",body:JSON.stringify(t)},e)}async getNewsletterSendHistory(e){return this.makeRequest(this.baseURLs.newsletterSend,{method:"GET"},e)}constructor(){this.baseURLs={auth:"https://auth-login.jhaladik.workers.dev",contentList:"https://content-list.jhaladik.workers.dev",contentCreate:n.env.CONTENT_CREATE_URL||"https://content-create.jhaladik.workers.dev",contentApprove:n.env.CONTENT_APPROVE_URL||"https://content-approve.jhaladik.workers.dev",contentOverride:n.env.CONTENT_MANUAL_OVERRIDE_URL||"https://content-manual-override.jhaladik.workers.dev",userPreferences:"https://user-preferences.jhaladik.workers.dev",userDashboard:n.env.USER_DASHBOARD_URL||"https://user-dashboard.jhaladik.workers.dev",userProfile:"https://user-profile.jhaladik.workers.dev",newsletterArchive:n.env.NEWSLETTER_ARCHIVE_URL||"https://newsletter-archive.jhaladik.workers.dev",adminDashboard:n.env.ADMIN_DASHBOARD_URL||"https://admin-dashboard.jhaladik.workers.dev",adminAnalytics:n.env.ADMIN_ANALYTICS_URL||"https://admin-analytics.jhaladik.workers.dev",adminPipeline:n.env.ADMIN_PIPELINE_CONTROL_URL||"https://admin-pipeline-control.jhaladik.workers.dev",newsletterSignup:"https://newsletter-signup.jhaladik.workers.dev",newsletterSend:n.env.NEWSLETTER_SEND_URL||"https://newsletter-send.jhaladik.workers.dev",newsletterTemplate:n.env.NEWSLETTER_TEMPLATE_URL||"https://newsletter-template.jhaladik.workers.dev",rssSources:"https://rss-sources-management.jhaladik.workers.dev"}}}let o=new s;t.Z=o},5568:function(e,t,r){"use strict";r.d(t,{E5:function(){return f},El:function(){return m},b3:function(){return g},uJ:function(){return p}});let n="ai_news_token",s="ai_news_user",o=()=>localStorage.getItem(n),i=e=>{localStorage.setItem(n,e)},a=()=>{localStorage.removeItem(n)},c=()=>{let e=localStorage.getItem(s);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},u=e=>{localStorage.setItem(s,JSON.stringify(e))},l=()=>{localStorage.removeItem(s)},h=e=>{try{let t=e.split(".");if(3!==t.length)return null;let r=t[1],n=atob(r.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(n)}catch(e){return null}},d=e=>{let t=h(e);if(!t)return!0;let r=Math.floor(Date.now()/1e3);return t.exp<r};class m{static getInstance(){return m.instance||(m.instance=new m),m.instance}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notify(){this.listeners.forEach(e=>e())}getAuthState(){let e=o(),t=c(),r=!!(e&&!d(e)&&t),n=r&&(null==t?void 0:t.role)==="admin";return{isAuthenticated:r,user:t,token:e,isAdmin:n}}login(e,t){i(e),u(t),this.notify()}logout(){a(),l(),this.notify()}updateUser(e){u(e),this.notify()}isAdmin(){let{isAuthenticated:e,user:t}=this.getAuthState();return e&&(null==t?void 0:t.role)==="admin"}isAuthenticated(){return this.getAuthState().isAuthenticated}getCurrentUser(){return this.getAuthState().user}getCurrentToken(){return this.getAuthState().token}checkTokenExpiration(){let e=o();e&&d(e)&&this.logout()}constructor(){this.listeners=[]}}let f=m.getInstance(),g=e=>e?e.name||e.email.split("@")[0]:"Guest",p=()=>{f.checkTokenExpiration(),setInterval(()=>{f.checkTokenExpiration()},3e5)}},8997:function(e,t,r){"use strict";r.d(t,{AQ:function(){return a},B9:function(){return h},DG:function(){return i},Ls:function(){return o},SI:function(){return l},W9:function(){return u},e$:function(){return d},kR:function(){return g},p6:function(){return n},uf:function(){return m},wc:function(){return c}});let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new Date(1e3*e),n=new Date().getTime()-r.getTime(),s=Math.floor(n/6e4),o=Math.floor(n/36e5),i=Math.floor(n/864e5);if(t.relative){if(s<1)return"Just now";if(s<60)return"".concat(s," minute").concat(1===s?"":"s"," ago");if(o<24)return"".concat(o," hour").concat(1===o?"":"s"," ago");if(i<7)return"".concat(i," day").concat(1===i?"":"s"," ago")}let a={year:"numeric",month:t.short?"short":"long",day:"numeric"};return t.includeTime&&(a.hour="numeric",a.minute="2-digit",a.hour12=!0),r.toLocaleDateString("en-US",a)},s=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return e.length<=t?e:e.slice(0,t-r.length)+r},o=e=>e.replace(/\b\w/g,e=>e.toUpperCase()),i=e=>o(e.replace(/_/g," ")),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:150;return s(e.replace(/<[^>]*>/g,""),t)},c=e=>({draft:"bg-gray-100 text-gray-800",ai_generated:"bg-blue-100 text-blue-800",review:"bg-yellow-100 text-yellow-800",published:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",failed:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800",u=e=>({emergency:"bg-red-100 text-red-800",local:"bg-blue-100 text-blue-800",business:"bg-green-100 text-green-800",community:"bg-purple-100 text-purple-800",events:"bg-orange-100 text-orange-800"})[e]||"bg-gray-100 text-gray-800",l=e=>[...e].sort((e,t)=>"emergency"===e.category&&"emergency"!==t.category?-1:"emergency"===t.category&&"emergency"!==e.category?1:t.created_at-e.created_at),h=(e,t)=>{if(!t.trim())return e;let r=t.toLowerCase();return e.filter(e=>e.title.toLowerCase().includes(r)||e.content.toLowerCase().includes(r)||e.neighborhood_name.toLowerCase().includes(r)||e.category.toLowerCase().includes(r))},d=e=>{if("string"==typeof e)return e;if(e&&"object"==typeof e){if(e.error)return e.error;if("message"in e&&"string"==typeof e.message)return e.message}return"An unexpected error occurred"},m=e=>new Intl.NumberFormat("en-US").format(e),f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return"".concat((100*e).toFixed(t),"%")},g=e=>f(e)},9645:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r(5893),s=r(6887),o=r(971);function i(e){let{Component:t,pageProps:r}=e;return(0,n.jsx)(o.VW,{children:(0,n.jsx)(s.Ho,{children:(0,n.jsx)(t,{...r})})})}r(3434)},3434:function(){},7663:function(e){!function(){var t={229:function(e){var t,r,n,s=e.exports={};function o(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var c=[],u=!1,l=-1;function h(){u&&n&&(u=!1,n.length?c=n.concat(c):l=-1,c.length&&d())}function d(){if(!u){var e=a(h);u=!0;for(var t=c.length;t;){for(n=c,c=[];++l<t;)n&&n[l].run();l=-1,t=c.length}n=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new m(e,t)),1!==c.length||u||a(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var o=r[e]={exports:{}},i=!0;try{t[e](o,o.exports,n),i=!1}finally{i&&delete r[e]}return o.exports}n.ab="//";var s=n(229);e.exports=s}()}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[774,179],function(){return t(6840),t(3079)}),_N_E=e.O()}]);